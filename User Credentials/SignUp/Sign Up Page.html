<!DOCTYPE html>
<html>
<head>
  <link href="https://fonts.googleapis.com/css?family=Inter&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <link href="./css/main.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <title>Sign-up Page</title>
  <link rel="shortcut icon" type="image/png" href="images/ofc_Logo.png"> 
</head>
<body>
  <div class="v12_2185">
    <div class="v12_2186"></div>
    <div class="v12_2187"></div>
    <div class="v3_172"></div>
    <div class="v14_2211"></div>
      <span class="v3_304">Create an Account</span>
      <span class="v3_305">Welcome to Rajah Tupas Medical Services</span>
    <div class="name"></div>
    <form class="form-floating" id="floating">
      <div class="form-floating">
        <input class="form-control" type="text" id="floatingUsername" placeholder="Enter Username" aria-label="default input example">
        <label for="floatingUsername">Username</label>
        <i class="fas fa-check-circle"></i>
        <i class="fas fa-exclamation-circle"></i>
        <small>Error message</small>
      </div>
      <div class="form-floating">
        <input type="email" class="form-control" id="floatingEmail" aria-label="default input example" placeholder="name@example.com">
        <label for="floatingEmail">Email address</label>
        <i class="fas fa-check-circle"></i>
        <i class="fas fa-exclamation-circle"></i>
        <small>Error message</small>
      </div>
      <div class="form-floating">
        <input type="password" class="form-control" id="floatingPassword" placeholder="Password">
        <label for="floatingPassword">Password</label>
        <i class="fas fa-check-circle"></i> 
        <i class="fas fa-exclamation-circle"></i>
        <small>Error message</small>
      </div>
      <div class="form-floating">
        <input type="password" class="form-control" id="floatingPassword2" placeholder="Password">
        <label for="floatingPassword">Re-enter Password</label>
        <i class="fas fa-check-circle"></i>
        <i class="fas fa-exclamation-circle"></i>
        <small>Error message</small>
      </div>
      <div class="v3_318">
        <div class="v3_319"></div>  
        <div class="col-12">
          <button class="btn" style="background-color:transparent" type="submit" id="sub_btn">Create an Account</button>
        </div>
      </div>
    </form>
    <div class="v3_311">
      <div class="name"></div>
      <div class="name"></div><span class="v3_314">or</span>
    </div>
    <div class="v3_325">
        <i class="fa-regular fa-user"></i>
    </div>
    <div class="v3_326">
      <i class="fa-regular fa-envelope"></i>
    </div>
    <div class="v3_327">
      <img src="images/padlock2.png" style="width: 40px;">
    </div>
    <div class="v3_328">
      <img src="images/padlock2.png" style="width: 40px;">
    </div>
    <div class="v12_2198">
      <div class="v3_329"></div>
      <div class="v3_331">
        <button class="btn" style="background-color:transparent" id="facebooksignup">Sign up with Facebook</button>
      </div>
      <div class="v3_333"></div>
    </div>
    <div class="v12_2200"></div>
      <div class="v12_2201"></div>
      <div class="v3_332">
        <button class="btn" style="background-color:transparent" id="googlesignup">Sign up with Google</button>
      </div>
    <div class="v3_334"></div><span class="v15_3">Already have an account? </span>
    <div class="v15_4">
      <a href="/User Credentials/LogIn/login.html" class="link" style="background-color:transparent" type="submit">Login here</a>
    </div>
  </div>
  <script  src="./main.js"></script>
  <script type="module">
    // Functions for the Firebase using CDN
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-analytics.js";
    import { getDatabase, set, ref, update } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-database.js";
    import { getAuth, updateProfile, createUserWithEmailAndPassword, FacebookAuthProvider,signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBju8Bjp1PU8hpQaYhzu7CS81B9Zq6Tubk",
      authDomain: "erm-system-33be8.firebaseapp.com",
      databaseURL: "https://erm-system-33be8-default-rtdb.firebaseio.com",
      projectId: "erm-system-33be8",
      storageBucket: "erm-system-33be8.appspot.com",
      messagingSenderId: "1080942188838",
      appId: "1:1080942188838:web:2f1c49b62bc7d00aae09e7",
      measurementId: "G-RRB0LHPBLV"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth(app);
    const database = getDatabase(app);
    const provider = new GoogleAuthProvider(app);
    const provider2 = new FacebookAuthProvider(app);

    // References
    const submit = document.getElementById('sub_btn');
    
    // Validation
    floating.addEventListener('submit', (e) =>{

      var email = document.getElementById('floatingEmail').value;
      var password = document.getElementById('floatingPassword').value;
      var Username = document.getElementById('floatingUsername').value;
      var Email1 = document.getElementById('floatingEmail').value;
      var displayName = document.getElementById('floatingUsername').value;
      e.preventDefault();

        async function signUp(email, password, displayName){
          try {
              const res = await createUserWithEmailAndPassword(auth, email, password)
              await set(ref(database, "Reg_Users/" + res.user.uid), {Username: Username, Email: Email1,});
              const update = await updateProfile(auth.currentUser, {displayName})
              alert('user created');

          } catch (error) {
              const errorCode = error.code;
              const errorMessage = error.message;

              alert(errorMessage);
          }
        }
      signUp(email, password, displayName);
    });


    googlesignup.addEventListener('click', (e)=>{
      signInWithPopup(auth, provider)
      .then((result) => {
            // Google Access Token
            const credential = GoogleAuthProvider.credentialFromResult(result);
            const token = credential.accessToken;
            // The signed-in user info.
            const user = result.user;

            alert(user.displayName);
        })
        .catch((error) => {
            // Handle Errors here.
            const errorCode = error.code;
            const errorMessage = error.message;
            // The email of the user's account used.
            const email = error.customData.email;
            // The AuthCredential type that was used.
            const credential = GoogleAuthProvider.credentialFromError(error);

            alert(errorMessage);
        });
    })

    facebooksignup.addEventListener('click', (e)=>{
      provider2.addScope('user_birthday');
        signInWithPopup(auth, provider2)
        .then((result) => {
            // The signed-in user info.
            const user = result.user;

            // Facebook Access Token
            const credential = FacebookAuthProvider.credentialFromResult(result);
            const accessToken = credential.accessToken;
            console.log("user", user);

            alert(user.displayName);

        })
        .catch((error) => {
            // Handle Errors here.
            const errorCode = error.code;
            const errorMessage = error.message;
            // The email of the user's account used.
            const email = error.customData.email;
            // The AuthCredential type that was used.
            const credential = FacebookAuthProvider.credentialFromError(error);

            alert(errorMessage);
        });
    })
  </script>
</body>
</html>